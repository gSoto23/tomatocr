<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TOMATO CR | Cotizador</title>
  <link rel="icon" href="./icon.png" />
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="style.css" />
</head>

<body class="min-h-screen">
<header class="max-w-6xl mx-auto px-5 pt-8 pb-6 no-print">
  <div class="flex flex-col gap-6">
    <!-- Fila Superior: Logo, T√≠tulo y Bot√≥n Tema -->
    <div class="flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <img src="./LogoTomatoB.png" id="mainLogo" class="h-10 w-auto" alt="TOMATO CR" />
        <div>
          <div class="text-xl font-semibold tracking-wide">Cotizador Cloud</div>
          <div class="muted text-sm">Sincronizado con Supabase SQL</div>
        </div>
      </div>
      <!-- Bot√≥n Tema alineado a la derecha del t√≠tulo -->
      <button class="btn p-2 rounded-full w-10 h-10 flex items-center justify-center text-lg" id="btnTheme" title="Cambiar Tema">üåì</button>
    </div>

    <!-- Fila Inferior: Acciones de Cotizaci√≥n -->
    <div class="flex items-center justify-end gap-2 flex-wrap border-t border-neutral-800/50 pt-4">
      <span class="pill" id="quoteNumberPill">‚Äî</span>
      <button class="btn" id="btnNew">Nueva</button>
      <button class="btn" id="btnDuplicate">Duplicar</button>
      <button class="btn" id="btnSave">Guardar en Nube</button>
      <button class="btn btn-danger" id="btnClearDraft" title="Borrar datos actuales">
        <span class="danger">Borrar Borrador</span>
      </button>
    </div>
  </div>
</header>

<main class="max-w-6xl mx-auto px-5 pb-10">
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-5">
    <!-- Left: Header / Client -->
    <section class="card p-5 lg:col-span-2">
      <div class="flex items-start justify-between gap-3">
        <div>
          <h2 class="text-xl font-semibold">Datos generales</h2>
          <p class="muted text-sm mt-1">Complete lo m√≠nimo y agregue √≠tems. Todo se calcula autom√°ticamente.</p>
        </div>
        <div class="text-right">
          <label for="issueDate" class="muted text-xs block">Fecha emisi√≥n</label>
          <input class="inp mt-1" type="date" id="issueDate" />
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-5">
        <div>
          <label for="clientName" class="muted text-xs block">Cliente / Empresa *</label>
          <input class="inp mt-1" id="clientName" placeholder="Nombre de la institucion" />
        </div>
        <div>
          <label for="clientId" class="muted text-xs block">Contacto (opcional)</label>
          <input class="inp mt-1" id="clientId" placeholder="Nombre del contacto" />
        </div>

        <div>
          <label for="clientEmail" class="muted text-xs block">Correo (opcional)</label>
          <input class="inp mt-1" type="email" id="clientEmail" placeholder="cliente@correo.com" />
        </div>
        <div>
          <label for="clientPhone" class="muted text-xs block">Tel√©fono (opcional)</label>
          <input class="inp mt-1" id="clientPhone" placeholder="8888 8888" />
        </div>

        <div class="md:col-span-2">
          <label for="clientAddress" class="muted text-xs block">Direcci√≥n / Ubicaci√≥n</label>
          <input class="inp mt-1" id="clientAddress" placeholder="Direcci√≥n / referencias" />
        </div>

        <div>
          <label for="serviceType" class="muted text-xs block">Tipo de servicio</label>
          <select class="inp mt-1" id="serviceType">
            <option value="Jardiner√≠a">Jardiner√≠a</option>
            <option value="Paisajismo">Paisajismo</option>
            <option value="Zonas Verdes">Zonas Verdes</option>
            <option value="Limpieza de lote">Limpieza de lote</option>
            <option value="Poda / corta">Poda / corta</option>
            <option value="Otro">Otro</option>
          </select>
        </div>
        <div>
          <label for="frequency" class="muted text-xs block">Frecuencia</label>
          <select class="inp mt-1" id="frequency">
            <option value="Por demanda">Por demanda</option>
            <option value="Semanal">Semanal</option>
            <option value="Quincenal">Quincenal</option>
            <option value="Mensual">Mensual</option>
            <option value="√önica">√önica</option>
          </select>
        </div>

        <div>
          <label for="validDays" class="muted text-xs block">Validez (d√≠as)</label>
          <input class="inp mt-1" type="number" min="1" id="validDays" value="15" />
        </div>
        <div>
          <label for="currency" class="muted text-xs block">Moneda</label>
          <select class="inp mt-1" id="currency">
            <option value="CRC">CRC (‚Ç°)</option>
            <option value="USD">USD ($)</option>
          </select>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-5">
        <div>
          <label for="notes" class="muted text-xs block">Notas / Alcance (PDF)</label>
          <textarea class="inp mt-1 h-28" id="notes" placeholder="Ej. Incluye: corte, recolecci√≥n..."></textarea>
        </div>
        <div>
          <label for="terms" class="muted text-xs block">T√©rminos (PDF)</label>
          <textarea class="inp mt-1 h-28" id="terms"></textarea>
        </div>
      </div>
    </section>

    <!-- Right: Totals -->
    <aside class="card p-5 no-print">
      <h2 class="text-xl font-semibold">Resumen</h2>
      <p class="muted text-sm mt-1">Totales autom√°ticos.</p>

      <div class="mt-5 space-y-4">
        <div class="flex items-center justify-between">
          <span class="muted">Subtotal</span>
          <span class="font-semibold" id="subtotalView">‚Äî</span>
        </div>

        <div class="flex items-center justify-between gap-3">
          <div class="flex items-center gap-2">
            <input type="checkbox" id="taxEnabled" class="h-4 w-4" checked />
            <label for="taxEnabled" class="muted cursor-pointer">IVA</label>
          </div>
          <div class="flex items-center gap-2">
            <input class="inp w-20 text-right" type="number" id="taxRate" min="0" step="0.1" value="13" />
            <span class="muted">%</span>
          </div>
        </div>

        <div class="flex items-center justify-between">
          <span class="muted">IVA</span>
          <span class="font-semibold" id="taxView">‚Äî</span>
        </div>

        <div class="flex items-center justify-between gap-3">
          <span class="muted">Descuento</span>
          <input class="inp w-32 text-right" type="number" id="discount" min="0" step="1" value="0" />
        </div>

        <div class="border-t border-neutral-800 pt-4 flex items-center justify-between">
          <span class="text-lg font-semibold">Total</span>
          <span class="text-2xl font-bold text-black" id="totalView">‚Äî</span>
        </div>

        <div class="pt-6">
          <button class="btn btn-primary w-full py-4 text-lg" id="btnPDF">Exportar PDF</button>
        </div>
      </div>
    </aside>
  </div>

  <!-- Items -->
  <section class="card p-5 mt-5">
    <div class="flex items-center justify-between gap-3 flex-wrap">
      <div>
        <h2 class="text-xl font-semibold">√çtems</h2>
        <p class="muted text-sm mt-1">L√≠neas de servicio o materiales.</p>
      </div>
      <div class="flex items-center gap-2">
        <button class="btn" id="btnAddService">+ Servicio</button>
        <button class="btn" id="btnAddMaterial">+ Material</button>
      </div>
    </div>

    <div class="overflow-x-auto mt-4">
      <table class="table w-full text-sm">
        <thead>
        <tr>
          <th style="width: 120px;">Tipo</th>
          <th>Descripci√≥n</th>
          <th style="width: 120px;">Unidad</th>
          <th style="width: 100px;" class="text-right">Cant.</th>
          <th style="width: 140px;" class="text-right">Precio unit.</th>
          <th style="width: 140px;" class="text-right">Total</th>
          <th style="width: 50px;"></th>
        </tr>
        </thead>
        <tbody id="itemsBody"></tbody>
      </table>
    </div>
  </section>

  <!-- Recent -->
  <section class="card p-5 mt-5 no-print">
    <div class="flex items-center justify-between gap-3 flex-wrap">
      <div>
        <h2 class="text-xl font-semibold">Historial en la Nube (SQL)</h2>
        <p class="muted text-sm mt-1">√öltimas cotizaciones guardadas en Supabase.</p>
      </div>
      <button class="btn" id="btnRefreshRecent">Actualizar</button>
    </div>

    <div class="overflow-x-auto mt-4">
      <table class="table w-full text-sm">
        <thead>
        <tr>
          <th style="width: 140px;">N√∫mero</th>
          <th>Cliente</th>
          <th style="width: 140px;">Fecha</th>
          <th style="width: 160px;" class="text-right">Total</th>
          <th style="width: 180px;">Acciones</th>
        </tr>
        </thead>
        <tbody id="recentBody"></tbody>
      </table>
    </div>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="./app.js"></script>
</body>
</html>